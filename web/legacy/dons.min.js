function Dons(){this.buttons={adherent:".button-je-donne-adherent",nonAdherent:".button-je-donne-non-adherent"},this.sections={adherent:"adherent",nonAdherent:"non-adherent"},this.moveHandlers={"data-page-next":this.nextSection,"data-page-prev":this.previousSection},this.root="je-donne",this.section="initial",this.step=0,this.data={value:void 0},this.params=this.getUrlVars,""!=this.params.montant&&(this.data={value:this.params.montant}),this.initialize()}Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - ce qui est à lier ne peut être appelé");var n=Array.prototype.slice.call(arguments,1),t=this,r=function(){},i=function(){return t.apply(this instanceof r?this:e,n.concat(Array.prototype.slice.call(arguments)))};return this.prototype&&(r.prototype=this.prototype),i.prototype=new r,i}),$.extend($.validator.messages,{required:"Ce champ est obligatoire.",remote:"Veuillez corriger ce champ.",email:"Veuillez fournir une adresse électronique valide.",url:"Veuillez fournir une adresse URL valide.",date:"Veuillez fournir une date valide.",dateISO:"Veuillez fournir une date valide (ISO).",number:"Veuillez fournir un numéro valide.",digits:"Veuillez fournir seulement des chiffres.",creditcard:"Veuillez fournir un numéro de carte de crédit valide.",equalTo:"Confirmez votre mot de passe",extension:"Veuillez fournir une valeur avec une extension valide.",maxlength:$.validator.format("Veuillez fournir au plus {0} caractères."),minlength:$.validator.format("Veuillez fournir au moins {0} caractères."),rangelength:$.validator.format("Veuillez fournir une valeur qui contient entre {0} et {1} caractères."),range:$.validator.format("Veuillez fournir une valeur entre {0} et {1}."),max:$.validator.format("Veuillez fournir une valeur inférieure ou égale à {0}."),min:$.validator.format("Veuillez fournir une valeur supérieure ou égale à {0}."),maxWords:$.validator.format("Veuillez fournir au plus {0} mots."),minWords:$.validator.format("Veuillez fournir au moins {0} mots."),rangeWords:$.validator.format("Veuillez fournir entre {0} et {1} mots."),letterswithbasicpunc:"Veuillez fournir seulement des lettres et des signes de ponctuation.",alphanumeric:"Veuillez fournir seulement des lettres, nombres, espaces et soulignages.",lettersonly:"Veuillez fournir seulement des lettres.",nowhitespace:"Veuillez ne pas inscrire d'espaces blancs.",ziprange:"Veuillez fournir un code postal entre 902xx-xxxx et 905-xx-xxxx.",integer:"Veuillez fournir un nombre non décimal qui est positif ou négatif.",vinUS:"Veuillez fournir un numéro d'identification du véhicule (VIN).",dateITA:"Veuillez fournir une date valide.",time:"Veuillez fournir une heure valide entre 00:00 et 23:59.",phoneIntl:"Veuillez fournir un numéro de téléphone valide.",phoneUS:"Veuillez fournir un numéro de téléphone valide.",phoneUK:"Veuillez fournir un numéro de téléphone valide.",mobileUK:"Veuillez fournir un numéro de téléphone mobile valide.",strippedminlength:$.validator.format("Veuillez fournir au moins {0} caractères."),email2:"Veuillez fournir une adresse électronique valide.",url2:"Veuillez fournir une adresse URL valide.",creditcardtypes:"Veuillez fournir un numéro de carte de crédit valide.",ipv4:"Veuillez fournir une adresse IP v4 valide.",ipv6:"Veuillez fournir une adresse IP v6 valide.",require_from_group:"Veuillez fournir au moins {0} de ces champs.",nifES:"Veuillez fournir un numéro NIF valide.",nieES:"Veuillez fournir un numéro NIE valide.",cifES:"Veuillez fournir un numéro CIF valide.",postalCodeCA:"Veuillez fournir un code postal valide."}),jQuery.validator.addMethod("correctAmount",function(e,n){return this.optional(n)||parseInt(e)<=7500},"Votre don ne doit pas être supérieur à 7500€"),jQuery.validator.addMethod("correctName",function(e,n){return!!/^[a-z- ’'àèìòùÀÈÌÒÙáéíóúýÁÉÍÓÚÝâêîôûÂÊÎÔÛãñõÃÑÕäëïöüÿÄËÏÖÜŸçÇßØøÅåÆæœ]+$/i.test(e)},"Merci d'indiquer un nom correct."),jQuery.validator.addMethod("postalCode",function(e,n){return!!/^[0-9]{5}$/.test(e)||!!/^[a-zA-Z0-9 -]+$/.test(e)},"Merci d'indiquer un code postal correct."),$.validator.addMethod("haveMoreThan16",function(e,n){return this.optional(n)||parseInt(e)>=15},"Vous devez avoir au moins 15 ans pour adhérer."),$.validator.addMethod("phoneFR",function(e,n){return this.optional(n)||/^(\+)?[0-9]{0,22}$/.test(e)},"Veuillez entrer un numéro de téléphone valide."),$.validator.addMethod("phoneIntl",function(e,n){return this.optional(n)||/^(\+)?[0-9]{0,22}$/.test(e)},"Veuillez entrer un numéro de téléphone valide."),Dons.prototype={hideAll:function(){},currentSection:function(){return"."+[this.root,this.section].join("-")},currentStep:function(){return".step-"+this.step.toString()},current:function(){return this.currentSection()+this.currentStep()},saveFormData:function(){this.data=_.extend(this.data,_.fromPairs(_.without(_.map($(this.current()+" form").find("input"),function(e){if("radio"!=e.type||0!=e.checked)return[$(e).attr("name"),e.value]}),void 0)))},restoreFormData:function(){var e=this;_.each(this.data,function(n,t){var r=$(e.current()).find("[name='"+t+"']");r.length>0&&(r.length>1?$(e.current()).find("[name='"+t+"'][value='"+n+"']")[0].checked=!0:r.val(n))})},isNotOnLastPage:function(){return".je-donne-non-adherent.step-2"!=this.current()&&".je-donne-adherent.step-3"!=this.current()},isOnLockedFormPage:function(){return".je-donne-non-adherent.step-2"==this.current()||".je-donne-adherent.step-3"==this.current()},isOnFormPage:function(){return this.isOnLockedFormPage()||".je-donne-non-adherent.step-1"==this.current()||".je-donne-adherent.step-1"==this.current()},nextSection:function(e){e=void 0===e?this.step+1:e,this.isCheckboxesValid()&&!this.isOnLockedFormPage()?(".step-1"==this.currentStep()&&this.saveFormData(),$(this.currentStep()).removeClass("visible"),this.step=e,$(".je-donne-nav li").removeClass("active"),$(".je-donne-nav li:nth-child("+(e+2)+")").addClass("active"),$(this.current()).addClass("visible"),$("html, body").animate({scrollTop:0},0),this.isOnLockedFormPage()&&this.restoreFormData()):console.warn("Next section refused, invalid")},previousSection:function(e){e=void 0===e?this.step-1:e,$(this.currentStep()).removeClass("visible"),this.step>0&&(this.step=e),0==this.step&&(this.section="initial"),$(".je-donne-nav li").removeClass("active"),$(".je-donne-nav li:nth-child("+(e+2)+")").addClass("active"),$(this.current()).addClass("visible")},isCheckboxesValid:function(){var e=$(this.current()+" form");console.log("form =>",e);var n=e.valid();return _.each($(e).find("input[type='checkbox']"),function(e){var t=$(e)[0],r=$(e).attr("id");console.log("Is checkbox checked ? ",t.checked),0==t.checked?($(t).parents("black-checkbox").append('<label id="'+r+'_error" class="error" for="'+r+"\">Merci d'accepter cette condition.</label>"),n=!1):$("#"+r+"_error").remove()}),n},bindFormsValidations:function(){var e=this;_.each($("form"),function(n){$(n).validate({onsubmit:!0,ignore:[],errorElement:"p",rules:{firstname:{correctName:!0},postal_code:{postalCode:!0},password:"required",password_confirm:{equalTo:"#password"},phone:{phoneIntl:!0},mobilephone:{phoneIntl:!0},"je-donne-montant-autre-value":{correctAmount:!0}},errorPlacement:function(e,n){var t=$(n);t.parents("form").find(".errors-field").length>0?t.parents("form").find(".errors-field").append(e):t.parent("label").length>0?t.parent("label").parent().after(e):t.parent().prepend(e)},submitHandler:function(n,t){return e.isCheckboxesValid()&&e.isNotOnLastPage()&&e.nextSection(),!1}}),$(n).on("submit",function(e){return e.preventDefault(),!1})})},handleMontant:function(){var e=this,n=_.template("Soit <%= (_.floor(parseFloat(montant) * (1/3), 2)) %>€ après réduction d'impôts."),t=$("label[for='je-donne-montant-autre']"),r=$("#je-donne-montant-autre-value, label[for='je-donne-montant-autre-value']");$("input[name='je-donne-montant']").on("change",function(){document.getElementById("je-donne-montant-autre-value").removeAttribute("required"),document.getElementById("je-donne-montant-autre-value").value="",$("#je-donne-montant-autre-value-error").remove()}),$("input[name='je-donne-montant'], #je-donne-montant-autre-value").on("change",function(){var i=_.filter(document.getElementsByName("je-donne-montant"),function(e){return 1==e.checked})[0],o=i.value;if("autre"==o){t.addClass("hidden"),r.removeClass("hidden"),$("#je-donne-montant-autre-value").attr("required","required"),$("#je-donne-montant-autre-value").focus();var o=document.getElementById("je-donne-montant-autre-value").value}else document.getElementById("je-donne-montant-autre-value").removeAttribute("required"),t.removeClass("hidden"),r.addClass("hidden");e.data.value=parseFloat(o),$.isNumeric(e.data.value)?$("[data-dons-resume]").html(n({montant:e.data.value})):(document.getElementById("je-donne-montant-autre-value").value="",console.warn("Invalid value: "+e.data.value.toString()))})},bindMainButtons:function(){var e=this;$(".show-next").click(function(){$(".form-montant").valid()&&($(".form-montant").addClass("hide"),$(".form-montant-next").removeClass("hide"),$("ol li.active").removeClass("active"),$("ol li:nth-child(2)").addClass("active"))}),$(_.values(this.buttons).join(",")).on("click",function(){e.isCheckboxesValid()&&($(e.currentStep()).removeClass("visible"),e.section=$(this).attr("class").replace("button-je-donne-",""),$(_.map(_.values(e.sections),function(e){return[this.root,e].join("-")}).join(",")).removeClass("visible"),e.step+=1,$(".je-donne-nav li").removeClass("active"),$(".je-donne-nav li:nth-child("+(e.step+2)+")").addClass("active"),$(e.current()).addClass("visible"))}),_.each(this.moveHandlers,function(n,t){var r=n.bind(e);$("["+t+"]").on("click",function(){var e=$.isNumeric($(this).attr(t))?parseInt($(this).attr(t)):void 0;r(e)})})},initialize:function(){this.handleMontant(),this.bindFormsValidations(),this.bindMainButtons()},getUrlVars:function(){var e,n=[],t=window.location.href.slice(window.location.href.indexOf("?")+1);t.indexOf("#")>1&&(t=t.slice(0,t.indexOf("#")));for(var r=t.split("&"),i=0;i<r.length;i++)e=r[i].split("="),n.push(e[0]),n[e[0]]=e[1];return n}},jQuery(document).ready(function(){$(".page-je-donne").length>0&&(window.dons=new Dons)});