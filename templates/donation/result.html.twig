{% extends 'donation/layout.html.twig' %}

{% block javascripts %}
    <script type="text/javascript">
        Kernel.onLoad(function() {
            hide(dom('#app-donation-redirect-form'));
            show(dom('#app-donation-redirect-loader'));
            document.getElementById('app-donation-redirect-form').submit();
        });
    </script>
{% endblock %}

{% block donation_content %}
    <ul class="donation__form-steps">
        <li>Montant</li>
        <li>Coordonnées</li>
        <li>Paiement</li>
        <li class="active">Confirmation</li>
    </ul>

    <div class="donation__result {{ successful ? 'donation__result--successful' : 'donation__result--failure' }}">
        {% if successful %}
            <div class="donation__result--successful__amount">
                Votre don de<br />
                <h3>{{ (donation.amount/100)|round(2) }}€</h3>
                est validé !
            </div>
            {% if not campaign_expired %}
                <div class="donation__result--successful__thankyou">
                    {% if is_registration %}
                        <span>Nous sommes heureux de vous compter parmi nous.</span>
                        <span>
                            Nous venons de vous envoyer un email pour confirmer votre adhésion.<br/>
                            Rendez-vous sur votre boîte email.
                        </span>
                    {% else %}
                        Les dons sont la première source de revenu de La République En Marche&nbsp;!
                    {% endif %}
                </div>

                <div class="text--body text--left">
                    Votre soutien financier est donc essentiel pour le mouvement ! Il nous permet de fournir à nos militants, nos élus et nos territoires les outils nécessaires au renouvellement de notre vie politique et au rayonnement des idées progressistes.
                </div>
            {% endif %}

            {% if not is_adherent %}
                <div class="text--body b__nudge--top">
                    <strong>Vous n'êtes pas encore adherent(e) !</strong><br/>
                    Rejoignez nos {{ nb_adherent|number_format(0, ',', ' ') }} adhérents dès maintenant :
                </div>
                <p class="b__nudge--bottom-large">
                    <a href="{{ path('app_membership_join') }}" class="btn btn--primary btn-medium">
                        J'adhère à La République En Marche !
                    </a>
                </p>
            {% endif %}

            {% if is_adherent and not is_newsletter_subscribed %}
                <div class="newsletter l__row l__row--h-stretch space--20-30 l__row--wrap l__tablet--col b__nudge--top">
                    <div class="text--body text--bold">
                        Tenez-vous au courant des actualités du mouvement et du gouvernement en vous abonnant à notre newsletter hebdomadaire !
                    </div>
                    {{ form_start(newsletter_form, { action: path('newsletter_subscription'), attr: { class: 'l__row l__row--wrap'} }) }}
                        <div>
                            {{ form_widget(newsletter_form.email, {
                                attr: {
                                    title: 'common.email_address',
                                    placeholder: 'common.email_address',
                                    class: 'form__email'
                                }
                            }) }}
                        </div>
                        <div class="b__nudge--top-5">
                            {{ form_widget(newsletter_form.postalCode, {
                                attr: {
                                    title: 'common.zip_code',
                                    placeholder: 'common.zip_code',
                                    class: 'form__zipcode'
                                }
                            }) }}
                            <button title="Je m'inscris à la newsletter" type="submit" class="form btn btn--primary">Je m'inscris</button>
                        </div>
                    {{ form_end(newsletter_form) }}
                </div>
            {% endif %}

            <p>
                <a href="{{ path('homepage') }}" class="text--summary">
                    Retour à l'accueil
                </a>
            </p>
        {% else %}
            <h3>
                Votre don n'a pas été effectué, soit car vous l'avez annulé soit car une erreur s'est produite.
            </h3>

            <p>
                <a href="{{ retry_url }}" class="btn btn--medium btn--primary">
                    Je souhaite réessayer
                </a>
            </p>

            <p class="donation-result__support">
                Si le problème se reproduit et que vous ne le comprenez pas, n'hésitez pas à contacter le
                <a href="mailto:support@en-marche.fr">support En Marche</a>.
            </p>
        {% endif %}
    </div>
{% endblock %}
